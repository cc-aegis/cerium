use mem;

struct U8Iter {
    ptr: &u16,
    curr: u16,
}

fn U8Iter::new(ptr: &u16) -> &U8Iter {
    let result = mem::alloc<U8Iter>(2);
    result.ptr = ptr;
    result.curr = 0;
    result
}

fn U8Iter::next(self: &U8Iter) -> any {
    let curr = self.curr;
    if curr != 0 {
        self.curr = 0;
        curr & 255
    } else {
        curr = ^self.ptr;
        self.ptr = self.ptr;
        self.curr = curr;
        curr >> 8
    }
}